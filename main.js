(()=>{"use strict";var t,e,i,s,n,o={},a={};function h(t){var e=a[t];if(void 0!==e)return e.exports;var i=a[t]={id:t,loaded:!1,exports:{}};return o[t](i,i.exports,h),i.loaded=!0,i.exports}h.m=o,e=Object.getPrototypeOf?t=>Object.getPrototypeOf(t):t=>t.__proto__,h.t=function(i,s){if(1&s&&(i=this(i)),8&s)return i;if("object"==typeof i&&i){if(4&s&&i.__esModule)return i;if(16&s&&"function"==typeof i.then)return i}var n=Object.create(null);h.r(n);var o={};t=t||[null,e({}),e([]),e(e)];for(var a=2&s&&i;"object"==typeof a&&!~t.indexOf(a);a=e(a))Object.getOwnPropertyNames(a).forEach((t=>o[t]=()=>i[t]));return o.default=()=>i,h.d(n,o),n},h.d=(t,e)=>{for(var i in e)h.o(e,i)&&!h.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},h.f={},h.e=t=>Promise.all(Object.keys(h.f).reduce(((e,i)=>(h.f[i](t,e),e)),[])),h.u=t=>t+".js",h.miniCssF=t=>{},h.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),h.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),i={},s="my-webpack-project:",h.l=(t,e,n,o)=>{if(i[t])i[t].push(e);else{var a,r;if(void 0!==n)for(var l=document.getElementsByTagName("script"),c=0;c<l.length;c++){var d=l[c];if(d.getAttribute("src")==t||d.getAttribute("data-webpack")==s+n){a=d;break}}a||(r=!0,(a=document.createElement("script")).charset="utf-8",a.timeout=120,h.nc&&a.setAttribute("nonce",h.nc),a.setAttribute("data-webpack",s+n),a.src=t),i[t]=[e];var u=(e,s)=>{a.onerror=a.onload=null,clearTimeout(m);var n=i[t];if(delete i[t],a.parentNode&&a.parentNode.removeChild(a),n&&n.forEach((t=>t(s))),e)return e(s)},m=setTimeout(u.bind(null,void 0,{type:"timeout",target:a}),12e4);a.onerror=u.bind(null,a.onerror),a.onload=u.bind(null,a.onload),r&&document.head.appendChild(a)}},h.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},h.nmd=t=>(t.paths=[],t.children||(t.children=[]),t),(()=>{var t;h.g.importScripts&&(t=h.g.location+"");var e=h.g.document;if(!t&&e&&(e.currentScript&&(t=e.currentScript.src),!t)){var i=e.getElementsByTagName("script");i.length&&(t=i[i.length-1].src)}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),h.p=t})(),(()=>{var t={179:0};h.f.j=(e,i)=>{var s=h.o(t,e)?t[e]:void 0;if(0!==s)if(s)i.push(s[2]);else{var n=new Promise(((i,n)=>s=t[e]=[i,n]));i.push(s[2]=n);var o=h.p+h.u(e),a=new Error;h.l(o,(i=>{if(h.o(t,e)&&(0!==(s=t[e])&&(t[e]=void 0),s)){var n=i&&("load"===i.type?"missing":i.type),o=i&&i.target&&i.target.src;a.message="Loading chunk "+e+" failed.\n("+n+": "+o+")",a.name="ChunkLoadError",a.type=n,a.request=o,s[1](a)}}),"chunk-"+e,e)}};var e=(e,i)=>{var s,n,[o,a,r]=i,l=0;if(o.some((e=>0!==t[e]))){for(s in a)h.o(a,s)&&(h.m[s]=a[s]);r&&r(h)}for(e&&e(i);l<o.length;l++)n=o[l],h.o(t,n)&&t[n]&&t[n][0](),t[n]=0},i=self.webpackChunkmy_webpack_project=self.webpackChunkmy_webpack_project||[];i.forEach(e.bind(null,0)),i.push=e.bind(null,i.push.bind(i))})(),h.d({},{Z:()=>G}),function(t){t.left="left",t.right="right"}(n||(n={}));const r=class{constructor(t,e,i,s=1){this.context=t,this.position=e,this.scale=s,this.loaded=!1,this.image=new Image,this.image.src=i,this.image.onload=()=>{this.width=this.image.width*this.scale,this.height=this.image.height*this.scale,this.loaded=!0}}draw(){this.image&&this.context.drawImage(this.image,this.position.x,this.position.y,this.width,this.height)}update(){this.draw()}};function l(t,e){return t.position.y+t.height>=e.position.y&&t.position.y<=e.position.y+e.height&&t.position.x<=e.position.x+e.width&&t.position.x+t.width>=e.position.x}const c=class{constructor(t,e,i,s=1,n=3){this.context=t,this.position=e,this.loaded=!1,this.image=new Image,this.image.onload=()=>{this.width=this.image.width/this.frameRate,this.height=this.image.height,this.loaded=!0},this.image.src=i,this.frameRate=s,this.currentFrame=0,this.frameBuffer=n,this.elapsedFrames=0}draw(){if(!this.image)return;const t={position:{x:this.currentFrame*this.image.width/this.frameRate,y:0},width:this.image.width/this.frameRate,height:this.image.height};this.context.drawImage(this.image,t.position.x,t.position.y,t.width,t.height,this.position.x,this.position.y,this.width,this.height)}update(){this.draw(),this.updateFrames()}updateFrames(){this.elapsedFrames++,this.elapsedFrames%this.frameBuffer==0&&(this.currentFrame<this.frameRate-1?this.currentFrame++:this.currentFrame=0)}},d=class extends c{constructor(t,e,i,s,o,a,h,r,l){super(t,e,h,r),this.context=t,this.position=e,this.field=i,this.velocity={x:0,y:1},this.gravity=.5,this.floorCollusions=s,this.ceilingCollusions=o,this.platformCollusions=a,this.hitbox={position:{x:this.position.x,y:this.position.y},width:l.hitbox.width,height:l.hitbox.height,offset:{x:l.hitbox.offset.x,y:l.hitbox.offset.y}},this.animations=l,this.lastDirection=n.right,this.isDied=!1,this.isStayOn=!1,this.dieTimer=0;for(let t in this.animations){const e=new Image;e.src=this.animations[t].imageSrc,this.animations[t].image=e}}switchSprite(t){this.sprite=t,this.image!==this.animations[t]&&this.loaded&&(this.image=this.animations[t].image,this.frameBuffer=this.animations[t].frameBuffer,this.frameRate=this.animations[t].frameRate)}update(){this.position.x+=this.velocity.x,this.updateFrames(),this.updateHitbox(),this.draw(),this.updateHitbox(),this.checkForHorizontalCollusions(),this.applyGravity(),this.updateHitbox(),this.checkForVerticalCollusions()}updateHitbox(){this.hitbox.position.x=this.position.x+this.hitbox.offset.x,this.hitbox.position.y=this.position.y+this.hitbox.offset.y}checkForHorizontalCollusions(){const t=this.floorCollusions;this.ceilingCollusions&&t.concat(this.ceilingCollusions);for(let e=0;e<t.length;e++){const i=t[e];if(l(this.hitbox,i)){if(this.velocity.x>0){this.stopX();const t=this.hitbox.position.x-this.position.x+this.hitbox.width;this.position.x=i.position.x-t-.01;break}if(this.velocity.x<0){this.stopX();const t=this.hitbox.position.x-this.position.x;this.position.x=i.position.x+i.width-t+.01;break}}}}stopX(){this.velocity.x=0}checkForVerticalCollusions(){const t=this.floorCollusions;this.ceilingCollusions&&t.concat(this.ceilingCollusions);for(let e=0;e<t.length;e++){const i=t[e];if(l(this.hitbox,i)){if(this.velocity.y>0){this.velocity.y=0,this.isStayOn=!0;const t=this.hitbox.position.y-this.position.y+this.hitbox.height;this.position.y=i.position.y-t-.01,this.touchDown();break}if(this.velocity.y<0){this.velocity.y=0;const t=this.hitbox.position.y-this.position.y;this.position.y=i.position.y+i.height-t+.01;break}}}for(let t=0;t<this.platformCollusions.length;t++){const s=this.platformCollusions[t];if(i=s,(e=this.hitbox).position.y+e.height>=i.position.y&&e.position.y+e.height<=i.position.y+i.height&&e.position.x<=i.position.x+i.width&&e.position.x+e.width>=i.position.x&&this.velocity.y>0){this.velocity.y=0,this.isStayOn=!0;const t=this.hitbox.position.y-this.position.y+this.hitbox.height;this.position.y=s.position.y-t-.01,this.touchDown();break}}var e,i}touchDown(){return!0}applyGravity(){this.velocity.y+=this.gravity,this.position.y+=this.velocity.y}dying(){this.switchSprite("hit")}},u=class extends d{constructor(t,e,i,s,n,o,a,h,r,l,c,d,u,m,p,f,g,y){super(t,e,i,s,n,o,r,l,c),this.cameraBox={position:{x:this.position.x,y:this.position.y},width:.8*p.width,height:150,leftPadding:.8*p.width/2-100},this.gameBox=p,this.lifes=3,this.score=0,this.coins=a,this.enemies=h,this.gameOver=d,this.winGame=u,this.isAtack=!1,this.gem=m,this.isSoundsOn=f,this.isRunning=!1,this.sounds={};for(const t in y){const e=new Audio(y[t]);Object.defineProperty(this.sounds,t,{value:e}),this.sounds[t].volume=g/100}}playAudio(t){this.isSoundsOn&&this.sounds[t].play()}stopAudio(t){this.isSoundsOn&&this.sounds[t].pause()}update(){super.update(),this.updateCameraBox(),this.isDied?(this.isStayOn||"hit"===this.sprite)&&this.currentFrame===this.frameRate-1&&(0===this.lifes?this.gameOver():this.revive()):(this.checkCoins(),this.checkFallOut(),this.checkEnemies())}updateCameraBox(){this.cameraBox.position={x:this.position.x-this.cameraBox.leftPadding,y:this.position.y}}isCameraRight(t){const e=this.cameraBox.position.x+this.cameraBox.width;e>=this.field.width||e>=this.gameBox.width+Math.abs(t.position.x)&&(t.position.x-=this.velocity.x)}isCameraLeft(t){const e=this.cameraBox.position.x;this.cameraBox.position.x<=0||e<=Math.abs(t.position.x)&&(t.position.x-=this.velocity.x)}checkCoins(){for(let t=0;t<this.coins.length;t++){const e=this.coins[t];l(this.hitbox,e)&&(this.score+=5,this.coins.splice(t,1),this.playAudio("coin"))}l(this.hitbox,this.gem)&&(this.score+=100,this.winGame(this.score))}checkEnemies(){for(let t=0;t<this.enemies.length;t++){const e=this.enemies[t];e.isDied?e.currentFrame===e.frameRate-1&&this.enemies.splice(t,1):this.isAtack?l({width:2*this.hitbox.width,height:2*this.hitbox.height,position:{x:this.hitbox.position.x-this.hitbox.width/2,y:this.hitbox.position.y+this.hitbox.height/2}},e)&&this.killEnemy(e):l(this.hitbox,e)&&(this.hitbox.position.y+this.hitbox.height-10<=e.position.y?this.killEnemy(e):(this.isStayOn||(this.velocity.y=0),this.die()))}}killEnemy(t){t.isDied=!0,t.dying(),this.playAudio("kill"),this.score+=t.price}checkFallOut(){this.hitbox.position.y+this.hitbox.height>=this.gameBox.height&&this.die()}die(){this.lifes-=1,this.isDied=!0}touchDown(){return this.isDied?(this.switchSprite("hit"),this.playAudio("hit")):this.playAudio("landing"),!0}revive(){this.playAudio("revive"),this.switchSprite("idle");const t=e=>{this.position.x=this.position.x-e,this.updateHitbox();let i=!1;for(let t=0;t<this.floorCollusions.length;){const e=this.floorCollusions[t];if(this.hitbox.position.x<=e.position.x+e.width&&this.hitbox.position.x+this.hitbox.width>=e.position.x){this.isStayOn=!0,this.velocity.y=0;const t=this.hitbox.position.y-this.position.y+this.hitbox.height;this.position.y=e.position.y-t-.01,i=!0,this.isDied=!1;break}t++}i||t(e+100)};t(200)}},m={hitbox:{width:35,height:55,offset:{x:65,y:50}},idle:{imageSrc:"./assets/warrior/Idle.png",frameRate:8,frameBuffer:3},idleLeft:{imageSrc:"./assets/warrior/IdleLeft.png",frameRate:8,frameBuffer:3},run:{imageSrc:"./assets/warrior/Run.png",frameRate:8,frameBuffer:5},runLeft:{imageSrc:"./assets/warrior/RunLeft.png",frameRate:8,frameBuffer:5},jump:{imageSrc:"./assets/warrior/Jump.png",frameRate:2,frameBuffer:3},jumpLeft:{imageSrc:"./assets/warrior/JumpLeft.png",frameRate:2,frameBuffer:3},fall:{imageSrc:"./assets/warrior/Fall.png",frameRate:2,frameBuffer:3},fallLeft:{imageSrc:"./assets/warrior/FallLeft.png",frameRate:2,frameBuffer:3},hit:{imageSrc:"./assets/warrior/Death.png",frameRate:6,frameBuffer:6},atack:{imageSrc:"./assets/warrior/Attack1.png",frameRate:4,frameBuffer:3},atackLeft:{imageSrc:"./assets/warrior/AttackLeft.png",frameRate:4,frameBuffer:3}},p={hitbox:{width:45,height:40,offset:{x:15,y:5}},move:{imageSrc:"./assets/enemy/bee/fly.png",frameRate:4,frameBuffer:3},moveLeft:{imageSrc:"./assets/enemy/bee/flyLeft.png",frameRate:4,frameBuffer:3},attack:{imageSrc:"./assets/enemy/bee/attack.png",frameRate:4,frameBuffer:3},attackLeft:{imageSrc:"./assets/enemy/bee/attackLeft.png",frameRate:4,frameBuffer:3},hit:{imageSrc:"./assets/enemy/bee/hit.png",frameRate:4,frameBuffer:2},hitLeft:{imageSrc:"./assets/enemy/bee/hit-Left.png",frameRate:4,frameBuffer:2}},f={hitbox:{width:40,height:25,offset:{x:5,y:5}},idle:{imageSrc:"./assets/enemy/Boar/Idle-Sheet-Black.png",frameRate:4,frameBuffer:3},move:{imageSrc:"./assets/enemy/Boar/Walk-Base-SheetBlack.png",frameRate:6,frameBuffer:3},moveLeft:{imageSrc:"./assets/enemy/Boar/Walk-Left-SheetBlack.png",frameRate:6,frameBuffer:3},run:{imageSrc:"./assets/enemy/Boar/Run-Sheet-Black.png",frameRate:6,frameBuffer:3},hit:{imageSrc:"./assets/enemy/Boar/Hit-Sheet-Black.png",frameRate:4,frameBuffer:3},hitLeft:{imageSrc:"./assets/enemy/Boar/Hit-Left-Black.png",frameRate:4,frameBuffer:3}},g={hitbox:{width:40,height:25,offset:{x:5,y:5}},idle:{imageSrc:"./assets/enemy/Boar/Idle-Sheet.png",frameRate:4,frameBuffer:3},move:{imageSrc:"./assets/enemy/Boar/Walk-Base-Sheet.png",frameRate:6,frameBuffer:3},moveLeft:{imageSrc:"./assets/enemy/Boar/Walk-Left-Sheet.png",frameRate:6,frameBuffer:3},run:{imageSrc:"./assets/enemy/Boar/Run-Sheet.png",frameRate:6,frameBuffer:3},hit:{imageSrc:"./assets/enemy/Boar/Hit-Sheet.png",frameRate:4,frameBuffer:3},hitLeft:{imageSrc:"./assets/enemy/Boar/Hit-Left.png",frameRate:4,frameBuffer:3}},y={hitbox:{width:40,height:25,offset:{x:5,y:5}},move:{imageSrc:"./assets/enemy/snail/walk-Sheet.png",frameRate:8,frameBuffer:3},moveLeft:{imageSrc:"./assets/enemy/snail/walk-Sheet-Left.png",frameRate:8,frameBuffer:3},hide:{imageSrc:"./assets/enemy/snail/Hide-Sheet.png",frameRate:8,frameBuffer:3},hideLeft:{imageSrc:"./assets/enemy/snail/Hide-Sheet-Left.png",frameRate:8,frameBuffer:3},hit:{imageSrc:"./assets/enemy/snail/Dead-Sheet.png",frameRate:8,frameBuffer:3},hitLeft:{imageSrc:"./assets/enemy/snail/Dead-Sheet-Left.png",frameRate:8,frameBuffer:3}},w=class extends d{constructor(t,e,i,s,n,o,a,h,r,l,c){super(t,e,i,s,n,o,a,h,r),this.speed=l,this.price=c}update(){super.update()}go(){this.velocity.x=-this.speed,this.lastDirection=n.left}stopX(){const t=this.velocity.x;this.velocity.x=-t,this.lastDirection===n.left?(this.switchSprite("moveLeft"),this.lastDirection=n.right):(this.switchSprite("move"),this.lastDirection=n.left)}},v=new Event("pauseTheGame",{bubbles:!0}),x=new Event("resumeTheGame",{bubbles:!0});new Event("cancelGameEvent",{bubbles:!0});const b=class{constructor(t,e="div",i="",s=""){const n=document.createElement(e);n.className=i,n.textContent=s,null!=t&&t.append(n),this.node=n}destroy(){this.node.remove()}},S=class extends b{constructor(t,e=""){super(t,"button","btn",e)}},k=class extends b{constructor(){super(document.body,"div","pop-up")}},B=class extends k{constructor(t,e){super(),this.startBtnHandler=async(t,e)=>{let i;i=void 0!==e?t<3?t+1:1:t,await this.startGame(i),this.destroy()},this.logoutBtnHandler=()=>{this.logout(),this.destroy()};const i=new b(this.node,"div","menu__conteiner",void 0!==e?`Поздравляем, вы набрали ${e} очков`:"Вы проиграли");new S(i.node,void 0!==e?"Следующий уровень":"Попробовать снова").node.onclick=async()=>{await this.startBtnHandler(t,e)},new S(i.node,"Выход").node.onclick=this.logoutBtnHandler}},_=class extends b{constructor(t,e,i,s){const n=new b(t,"fieldset","fieldset");super(n.node,"input","input"),this.node.type=e,this.node.id=null!=s?s:i,this.node.name=i,void 0!==s&&(this.node.value=s),new b(n.node,"label","input__label",null!=s?s:i).node.htmlFor=null!=s?s:i}},C=class extends _{constructor(t,e,i){super(t,"radio",e,i)}},E=class extends k{constructor(t){super(),this.continueBtnHandler=()=>{this.continueGame(),this.destroy()},this.loadBtnHandler=async()=>{await this.loadLevel(this.level),this.destroy()};const e=new b(this.node,"div","menu__conteiner","Выберите уровень");this.level=t,[1,2,3].forEach((t=>{const i=new C(e.node,"level",t.toString());i.node.checked=t===this.level,i.node.onchange=()=>{this.level=t}})),new S(e.node,"Загрузить уровень").node.onclick=this.loadBtnHandler,new S(e.node,"Начать игру").node.onclick=async()=>{await this.loadLevel(1)},G&&(new S(e.node,"Продолжить игру").node.onclick=this.continueBtnHandler)}},R=class extends k{constructor(t){super(),this.continueBtnHandler=()=>{this.continueGame(),this.destroy()},this.loadBtnHandler=()=>{this.destroy(),this.loadMenu=new E(this.data.level),this.loadMenu.loadLevel=this.startGame},this.startBtnHandler=async()=>{await this.startGame(1),this.destroy()},this.logoutBtnHandler=()=>{this.logout(),this.destroy()};const e=new b(this.node,"div","menu__conteiner",`Добро пожаловать, ${t.name}`);this.data=t,G&&(new S(e.node,"Продолжить игру").node.onclick=this.continueBtnHandler),new S(e.node,"Выбрать уровень").node.onclick=this.loadBtnHandler,new S(e.node,G?"Начать заново":"Начать игру").node.onclick=this.startBtnHandler,new S(e.node,"Выход").node.onclick=this.logoutBtnHandler}},L=class extends _{constructor(t,e){super(t,"checkbox",e)}},D=class extends b{constructor(t,e,i,s){super(t,"input","input__range"),this.setIsDisable=t=>{this.node.disabled=t},this.node.type="range",this.node.id=e,this.node.name=e,this.node.min=String(0),this.node.max=String(100),this.node.step=String(1),this.node.value=i.toString(),this.node.disabled=!s}},F=class extends k{constructor(t){super(),this.data=t;const e=new b(this.node,"div","menu__conteiner","Настройки"),i=new b(e.node,"form","settings__form"),s=new b(i.node,"fieldset","settings__fieldset"),n=new L(s.node,"Музыка");n.node.checked=this.data.isMusic;const o=new D(s.node,"music",this.data.music.toString(),this.data.isMusic);n.node.onchange=()=>{o.setIsDisable(!n.node.checked),this.data.isMusic=n.node.checked},o.node.onchange=()=>{this.data.music=Number(o.node.value)};const a=new b(i.node,"fieldset","settings__fieldset"),h=new L(a.node,"Звуки");h.node.checked=this.data.isSounds;const r=new D(a.node,"sounds",this.data.sounds.toString(),this.data.isSounds);h.node.onchange=()=>{r.setIsDisable(!h.node.checked),this.data.isSounds=h.node.checked},r.node.onchange=()=>{this.data.sounds=r.node.valueAsNumber};const l=new b(i.node,"fieldset","settings__fieldset","Уровень сложности");l.node.classList.add("settings__fieldset-level"),["easy","norm","hard"].forEach((t=>{const e=new C(l.node,"hardness",t);e.node.checked=this.data.hardness===t,e.node.onchange=()=>{this.data.hardness=t}}));const c=new b(i.node,"fieldset","settings__fieldset","Язык");c.node.classList.add("settings__fieldset-language"),["ru","en"].forEach((t=>{const e=new C(c.node,"language",t);e.node.checked=this.data.hardness===t,e.node.onchange=()=>{this.data.language=t}})),new S(e.node,"Save").node.onclick=()=>{dispatchEvent(x),this.onSave(this.data)},new S(e.node,"Cancel").node.onclick=()=>{dispatchEvent(x),this.destroy()}}},H=class extends k{constructor(){super(),this.loginBtnHandler=()=>{void 0!==this.textInput.node.value&&(this.loginHandler(this.textInput.node.value),this.destroy())};const t=new b(this.node,"div","menu__conteiner","Введите имя пользователя");this.textInput=new b(t.node,"input","input"),this.textInput.node.type="text",this.textInput.node.name="userName",this.textInput.node.placeholder="Имя",new S(t.node,"Продолжить").node.onclick=this.loginBtnHandler}},O=t=>{const e={name:t,saved:[],wins:[],level:1,settings:{isMusic:!0,music:50,isSounds:!0,sounds:50,hardness:"norm",language:"ru"}};return localStorage.setItem(t+"Data",JSON.stringify(e)),e},A=localStorage.getItem("user");let z=!1,G=!1;const I=new class extends b{constructor(){super(document.body,"header","header"),this.stopGame=(t,e)=>{null!==this.data&&void 0!==e&&(this.data.level=t<3?t+1:1);const i=new B(t,e);i.logout=this.logout,i.startGame=this.startGame},this.menuBtnHandler=()=>{dispatchEvent(v),this.destroyAllMenu(),null!==this.data&&(this.menu=new R(this.data),this.menu.logout=this.logout,this.menu.startGame=this.startGame,this.menu.continueGame=this.continueGame)},this.openSettingsHandler=()=>{dispatchEvent(v),this.destroyAllMenu(),null!==this.data&&(this.settingsMenu=new F(this.data.settings),this.settingsMenu.onSave=t=>{this.saveSettings(t),this.settingsMenu.destroy()})},this.addUserData=t=>{this.data=t},this.destroyAllMenu=()=>{var t,e,i,s;null===(t=this.menu)||void 0===t||t.destroy(),null===(e=this.settingsMenu)||void 0===e||e.destroy(),null===(s=null===(i=this.menu)||void 0===i?void 0:i.loadMenu)||void 0===s||s.destroy()},new S(this.node,"menu").node.onclick=this.menuBtnHandler,this.pauseBtn=new S(this.node,"pause"),this.pauseBtn.node.disabled=!0,this.pauseBtn.node.classList.add("btn_pause"),this.pauseBtn.node.onclick=()=>{this.pauseGame()},new S(this.node,"settings").node.onclick=this.openSettingsHandler}},M=new class{constructor(t=document.body,e=1024,i=600,s){var n,o,a,h;this.setSettings=t=>{this.isSoundsOn=null==t?void 0:t.isMusic,this.soundsVolume=null==t?void 0:t.music,this.isAudioOn=null==t?void 0:t.isSounds,this.audioVolume=null==t?void 0:t.sounds},this.canvas=document.createElement("canvas"),this.canvas.width=e,this.canvas.height=i,this.scaledCanvas={width:this.canvas.width/this.scale,height:this.canvas.height/this.scale},t.appendChild(this.canvas),this.context=this.canvas.getContext("2d"),this.isSoundsOn=null===(n=null==s?void 0:s.isMusic)||void 0===n||n,this.soundsVolume=null!==(o=null==s?void 0:s.music)&&void 0!==o?o:50,this.isAudioOn=null===(a=null==s?void 0:s.isSounds)||void 0===a||a,this.audioVolume=null!==(h=null==s?void 0:s.sounds)&&void 0!==h?h:50}async startGame(t=3){let e;switch(this.level=t,t){case 1:e=await h.e(949).then(h.t.bind(h,949,23)),this.backgroundSrc={src:"./assets/background/1_level/mtn.png",bgSize:{width:2618,height:571}},this.statickBg="./assets/background/1_level/bg_1.png",this.scaleBg=1;break;case 2:e=await h.e(103).then(h.t.bind(h,103,23)),this.backgroundSrc={src:"./assets/background/2_level/fon.png",bgSize:{width:300,height:300}};break;default:e=await h.e(361).then(h.t.bind(h,361,23)),this.backgroundSrc={src:"./assets/background/1_level/mtn.png",bgSize:{width:2618,height:571}},this.statickBg="./assets/background/1_level/bg_2.png",this.scaleBg=.8}this.gameField={width:e.width*e.tilewidth,height:e.height*e.tileheight},this.scale=this.canvas.height/this.gameField.height,this.scaledCanvas={width:this.canvas.width/this.scale,height:this.canvas.height/this.scale},this.tileSise={width:e.tilewidth,height:e.tileheight},this.mapSise={width:e.width,height:e.height};const i={};e.layers.forEach((t=>{"tilelayer"===t.type&&Object.defineProperty(i,t.name,{value:t.data,writable:!1})})),null!=this.context&&this.animate(this.context,{width:this.canvas.width,height:this.canvas.height},this.scale,this.scaledCanvas,this.gameField,this.tileSise,this.mapSise,e.tilemap,i)}animate(t,e,i,s,o,a,h,l,c){let d,v=!1;const x={left:!1,right:!1,atack:!1},b={position:{x:0,y:0}},S=()=>{document.fullscreenElement?document.exitFullscreen().catch((t=>{console.error(`Error attempting to enable fullscreen mode: ${t.message} (${t.name})`)})):this.canvas.requestFullscreen().catch((t=>{console.error(`Error attempting to enable fullscreen mode: ${t.message} (${t.name})`)}))};if(this.isAudioOn){const t=new Audio("./assets/audio/sounds/platformer_level03.mp3");t.volume=this.audioVolume/100,t.play()}const k=new class{constructor({context:t,size:e,columns:i,imgSrc:s,tileColumns:n}){this.context=t,this.size=e,this.columns=i,this.loaded=!1,this.tileColumns=n,this.image=new Image,this.image.src=s,this.image.onload=()=>{this.width=this.image.width,this.height=this.image.height,this.loaded=!0}}generateCollusionBlocks(t,e=0){const i=[],s=[];for(let e=0;e<t.length;e+=this.columns)i.push(t.slice(e,e+this.columns));return i.forEach(((t,e)=>{t.forEach(((t,i)=>{if(0!==t){const n=this.getTileCoordinates(t);s.push(new class{constructor(t,e,i,s,n){this.context=t,this.position=e,this.width=i,this.height=i,this.size=i,this.image=s,this.cropCoord=n}draw(){this.context.drawImage(this.image,this.cropCoord.x,this.cropCoord.y,this.size,this.size,this.position.x,this.position.y,this.width,this.height)}update(){this.draw()}}(this.context,{x:i*this.size,y:e*this.size},this.size,this.image,n))}}))})),s}getTileCoordinates(t){const e=t-1,i=Math.floor(e/this.tileColumns)*this.size;return{x:e%this.tileColumns*this.size,y:i}}}({context:t,size:a.width,columns:h.width,imgSrc:l.file,tileColumns:l.columns}),B=k.generateCollusionBlocks(c.floor),_=c.ceiling?k.generateCollusionBlocks(c.ceiling):[],C=k.generateCollusionBlocks(c.platforms),E=c.spikes?k.generateCollusionBlocks(c.spikes):[],R=c.decors?k.generateCollusionBlocks(c.decors):[],L=c.fon?k.generateCollusionBlocks(c.fon):[],D=c.rockfon?k.generateCollusionBlocks(c.rockfon):[],F=new class{constructor(t,e,i){this.context=t,this.size=e,this.columns=i}generateCollusionBlocks(t,e){const i=[],s=[];for(let e=0;e<t.length;e+=this.columns)i.push(t.slice(e,e+this.columns));return i.forEach(((t,i)=>{t.forEach(((t,n)=>{0!==t&&s.push(new class{constructor(t,e,i,s){this.context=t,this.position=e,this.width=i,this.height=i,this.size=i,s&&(this.img=new r(this.context,e,s))}draw(){this.context.fillStyle="rgba(0, 255, 0, 0.5)",this.context.fillRect(this.position.x,this.position.y,this.size,this.size)}update(){this.img?this.img.update():this.draw()}}(this.context,{x:n*this.size,y:i*this.size},this.size,e))}))})),s}generateEnemies(t,e,i,s,n){const o=[],a=[];for(let e=0;e<t.length;e+=this.columns)o.push(t.slice(e,e+this.columns));return o.forEach(((t,o)=>{t.forEach(((t,h)=>{if(0!==t){if(34===t){const t=new w(this.context,{x:h*this.size,y:o*this.size-25},e,i,s,n,"./assets/enemy/Boar/Walk-Base-Sheet.png",6,g,2,25);a.push(t)}if(6===t){const t=new w(this.context,{x:h*this.size,y:o*this.size-25},e,i,s,n,"./assets/enemy/Boar/Walk-Base-SheetBlack.png",6,f,2,25);a.push(t)}if(39===t){const t=new w(this.context,{x:h*this.size-5,y:o*this.size},e,i,s,n,"./assets/enemy/snail/walk-Sheet.png",8,y,.5,50);a.push(t)}if(22===t||7===t){const t=new w(this.context,{x:h*this.size,y:o*this.size},e,i,s,[],"./assets/enemy/bee/fly.png",4,p,1,100);t.gravity=0,t.velocity.y=0,a.push(t)}}}))})),a}}(t,a.width,h.width),H=c.coins?F.generateCollusionBlocks(c.coins,"./assets/icons/coin.png"):[],O=F.generateEnemies(c.enemy,o,B,_,C),A=this.statickBg?new r(t,{x:0,y:0},this.statickBg,this.scaleBg):void 0,z=new class{constructor(t,e){this.context=t,this.width=e.width,this.height=e.height}generate(t,e){const i=[],s=this.height/e.height,n=e.width*s,o=(e.height,Math.ceil(this.width/(e.width*s)));for(let e=0;e<=o;e++){const o=new r(this.context,{x:n*e,y:0},t,s);i.push(o)}return i}}(t,o).generate(this.backgroundSrc.src,this.backgroundSrc.bgSize),G=new r(t,{x:e.width-120,y:15},"./assets/icons/coin.png"),I=new r(t,{x:o.width-200,y:.7*o.height},"./assets/icons/gem.png"),M=[];for(let e=0;e<3;e++)M.push(new r(t,{x:30+30*e,y:15},"./assets/icons/heart.png",.5));const j=new u(t,{x:10,y:300},o,B,_,C,H,O,"./assets/warrior/Idle.png",8,m,(()=>{cancelAnimationFrame(d),this.stopGame(this.level)}),(t=>{cancelAnimationFrame(d),this.stopGame(this.level,t)}),I,s,this.isSoundsOn,this.soundsVolume,{attack:"./assets/audio/sounds/12_Player_Movement_SFX/56_Attack_03.wav",run:"./assets/audio/sounds/12_Player_Movement_SFX/03_Step_grass_03.wav",hit:"./assets/audio/sounds/10_Battle_SFX/55_Encounter_02.wav",jump:"./assets/audio/sounds/12_Player_Movement_SFX/30_Jump_03.wav",landing:"./assets/audio/sounds/12_Player_Movement_SFX/45_Landing_01.wav",coin:"./assets/audio/sounds/10_UI_Menu_SFX/079_Buy_sell_01.wav",kill:"./assets/audio/sounds/10_Battle_SFX/69_Enemy_death_01.wav",revive:"./assets/audio/sounds/8_Buffs_Heals_SFX/30_Revive_03.wav",gameOver:"./assets/audio/sounds/10_Battle_SFX/17_Def_buff_01.wav"});function P(){d=window.requestAnimationFrame(P),t.fillStyle="grey",t.fillRect(0,0,e.width,e.height),t.save(),t.scale(i,i),t.translate(b.position.x,0),z.forEach((t=>{t.update()})),null==A||A.update(),_.forEach((t=>{t.update()})),C.forEach((t=>{t.update()})),E.forEach((t=>{t.update()})),D.forEach((t=>{t.update()})),L.forEach((t=>{t.update()})),R.forEach((t=>{t.update()})),B.forEach((t=>{t.update()})),H.forEach((t=>{t.update()})),I.update(),j.update(),j.velocity.x=0,j.isDied||(x.atack&&(j.lastDirection===n.right?j.switchSprite("atack"):j.switchSprite("atackLeft"),j.playAudio("attack"),j.currentFrame===j.frameRate-1&&(j.isAtack=!1,x.atack=!1,j.stopAudio("run"),j.lastDirection===n.right?j.switchSprite("idle"):j.switchSprite("idleLeft"))),x.left?(j.switchSprite("runLeft"),j.velocity.x=-5,j.lastDirection=n.left,j.isCameraLeft(b),j.playAudio("run")):x.right?(j.switchSprite("run"),j.velocity.x=5,j.lastDirection=n.right,j.isCameraRight(b),j.playAudio("run")):0!==j.velocity.y||x.atack||(j.isRunning=!1,j.stopAudio("run"),j.lastDirection===n.right?j.switchSprite("idle"):j.switchSprite("idleLeft")),j.velocity.y<0&&!x.atack?(j.playAudio("jump"),j.isStayOn=!1,j.lastDirection===n.right?j.switchSprite("jump"):j.switchSprite("jumpLeft")):j.velocity.y>0&&!x.atack&&(j.lastDirection===n.right?j.switchSprite("fall"):j.switchSprite("fallLeft"))),O.forEach((t=>{0===t.velocity.x&&-b.position.x+s.width>=t.position.x&&t.go(),t.update()})),t.restore(),M.length>j.lifes&&M.pop(),M.forEach((t=>{t.update()})),G.update(),t.strokeText(j.score.toString(),e.width-50,50)}P(),window.addEventListener("keydown",(t=>{switch(t.keyCode){case 37:x.left=!0;break;case 38:j.isDied||(j.velocity.y=-10),t.preventDefault();break;case 39:x.right=!0;break;case 40:default:break;case 32:t.preventDefault(),x.atack=!0,j.isAtack=!0;break;case 122:t.preventDefault(),S()}})),window.addEventListener("keyup",(t=>{switch(t.keyCode){case 37:x.left=!1;break;case 39:x.right=!1;break;case 40:default:break;case 32:t.preventDefault()}})),window.addEventListener("pauseTheGame",(()=>{v||(v=!0,cancelAnimationFrame(d))})),window.addEventListener("resumeTheGame",(()=>{v&&(v=!1,P())}))}}(document.body);function j(t){const e=JSON.parse(t);I.addUserData(e)}function P(t){localStorage.setItem("user",t);const e=localStorage.getItem(t+"Data");if(null!==e)j(e);else{const e=O(t);I.addUserData(e)}I.menuBtnHandler()}if(M.stopGame=(t,e)=>{z=!1,G=!1,I.pauseBtn.node.disabled=!0,null!==A&&void 0!==e&&((t,e,i)=>{const s=localStorage.getItem(t+"Data");if(null!==s){const n=JSON.parse(s);n.level<e&&(n.level=e),n.wins.map((t=>t.level===e&&t.score<i?{level:e,score:i}:t)),localStorage.setItem(t+"Data",JSON.stringify(n))}})(A,t,e),I.stopGame(t,e)},I.continueGame=()=>{z=!1,dispatchEvent(x)},I.startGame=async t=>{z=!1,G=!0,I.pauseBtn.node.disabled=!1,await M.startGame(t)},I.logout=()=>{console.log("logoutBtnHandler"),localStorage.removeItem("user"),I.addUserData(null),z=!1,G=!1,I.pauseBtn.node.disabled=!0,(new H).loginHandler=P},I.saveSettings=t=>{null!==A&&(((t,e)=>{const i=localStorage.getItem(t+"Data");if(null!==i){const s=JSON.parse(i);s.settings=e,localStorage.setItem(t+"Data",JSON.stringify(s))}})(A,t),M.setSettings(t))},I.pauseGame=()=>{z?(z=!1,I.pauseBtn.node.innerText="Пауза",dispatchEvent(x)):(z=!0,I.pauseBtn.node.innerText="Продолжить",dispatchEvent(v))},null===A)(new H).loginHandler=P;else{const t=localStorage.getItem(A+"Data");null!==t&&j(t),I.menuBtnHandler()}document.addEventListener("keydown",(t=>{switch(t.keyCode){case 19:I.pauseGame();break;case 27:I.menuBtnHandler()}}))})();